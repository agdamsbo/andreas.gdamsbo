{
  "hash": "70d736e33e02359813be6456899f1696",
  "result": {
    "markdown": "---\ntitle: \"WSC 2023: Persistent low physical activity after stroke and risk of new vascular event or death\"\ndate: 2023-09-18\nexecute: \n  freeze: true\nimage: images/wsc2023.png\ndescription: Here is a few background notes on my oral presentation at the World Stroke Congress 2023. \ncategories:\n  - Conference abstract\n  - Physical activity\n  - Stroke\n  - Survival analysis\n  - R\n---\n\n\n## Intro\n\nI will presenting our work on \"Persistent low physical activity after stroke and risk of new vascular event or death\" at the World Stroke Congress 2023, Toronto, Canada on 11 October.\n\nI intended to do a little write up of the preparation work and the data analyses. Now, at the conference, I will be presenting tomorrow, and this is the last chance to put my notes together.\n\n## A long-term, registry based follow-up\n\nOur study is based on the \\[TALOS-trial\\](https://www.doi.org/10.1161/STROKEAHA.117.020067) cohort,. The trial was a randomised trial on citalopram in acute ischaemic stroke conducted between 2013-2016. For this study we did long-term follow-up on the pre-defined composit outcome of new vascular event (stroke, TIA or MI) or death of any cause. These data were obtained through the Danish health registries, that are based on a civil registration number given to all people living in Denmark. We have had access to hospital admission data nd death registrations. When sending in the abstract for WSC, I expected we would have been able to enrich our dataset further with data on socio-economic status as well as educational level. We are still awaiting these data, however, but these will be included when we get to the final publication of our findings.\n\n## Main points presented\n\nAt the WSC I will be presenting two of our main findings:\n\n1.  Patients with a persistent low level of physical activity (in the lowest quartile of our physical activity score measure) at both seven days just prior to their stroke as well as six months post-stroke have a significantly increased hazards ratio (HR) of our composite outcome, compared to the group of patients in the 2nd-4th quartile at both pre-stroke and six months post-stroke.\n2.  Patients in the lowest quartile pre-stroke, but in one the the higher quartile post-stroke, did not have a HR statistically significantly different from the group with a higher level at both time points.\n\nI think the first point is what we expected, but the second point is very encouraging. Though, this trial is observational, it still highlights, that increasing physical activity level in the stroke population may lower the risk of a clinical outcome such as new vascular event or death.\n\n## Smoothed survival plot\n\nI have been quite restricted in data management and which figures to present, as I have been working on a protected server, and I have only been allowed to present cumulative data. This means, that I also had to find a way to smooth the classic survival curve plot, as each step on the classic plot is representing a single subject, and thereby not allowed.\n\nBelow is the code I used for my presentation at WSC with some sample data. This code is based on the \\`ggsurvfit\\`-package, which eases the work with survival data, but I had to use a different approach to the smooth line and confidence interval. I played with other smoothing approaches, but this is the most straight-forward, I found.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.3     ✔ readr     2.1.4\n✔ forcats   1.0.0     ✔ stringr   1.5.0\n✔ ggplot2   3.4.3     ✔ tibble    3.2.1\n✔ lubridate 1.9.3     ✔ tidyr     1.3.0\n✔ purrr     1.0.2     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n:::\n\n```{.r .cell-code}\nlibrary(survival)\nlibrary(purrr)\nlibrary(ggsurvfit)\n\ndf <- survfit2(Surv(time, status) ~ surg, data = df_colon) |> \n  tidy_survfit(type = \"survival\")\n\ndf_split <- split(df,df$strata)\n\ndf_smoothed <- purrr::reduce(lapply(c(\"estimate\",\"conf.low\", \"conf.high\"), function(j) {\n  do.call(rbind,\n          lapply(seq_along(df_split), function(i) {\n            nms <- names(df_split)[i]\n            y <-\n              predict(mgcv::gam(as.formula(paste0(\n                j[[1]], \" ~ s(time, bs = 'cs')\"\n              )), data = df_split[[i]]))\n            df <- data.frame(df_split[[i]]$time, y, nms)\n            names(df) <- c(\"time\", paste0(j[[1]], \".smooth\"), \"strata\")\n            df\n          }))\n}),dplyr::full_join) |> full_join(df)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nJoining with `by = join_by(time, strata)`\nJoining with `by = join_by(time, strata)`\nJoining with `by = join_by(time, strata)`\n```\n:::\n\n```{.r .cell-code}\nggplot(data=df_smoothed) +\n  geom_line(aes(x=time, y=estimate.smooth, color = strata))+\n  geom_ribbon(aes(x=time, ymin = conf.low.smooth, ymax = conf.high.smooth, fill = strata), alpha = 0.50) +\n  # geom_smooth(aes(x=time, y=estimate, color = strata), method = \"gam\", formula = y ~ s(x, bs = \"cs\")) +\n  # reduce padding on edges of figure and format axes\n  scale_y_continuous(label = scales::percent, \n                     breaks = seq(0, 1, by = 0.2),\n                     expand = c(0.015, 0), limits = c(0,1)) +\n  scale_x_continuous(breaks = 0:10, \n                     expand = c(0.02, 0))+\n  labs(\n    y = \"Percentage Survival\",\n    title = \"Recurrence by Time From Surgery to Randomization\",\n  ) +\n  # limit plot to show 8 years and less\n  coord_cartesian(xlim = c(0, 8))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 9 rows containing missing values (`geom_line()`).\n```\n:::\n\n::: {.cell-output-display}\n![](pa_events_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "pa_events_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}